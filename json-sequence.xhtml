<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1 plus MathML 2.0//EN" "file:///home/nico/I-Ds/IETF/../test/src/../data/xhtml-math11-f.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="GENERATOR" content="LyX 2.0.2" />
<meta http-equiv="Content-type" content="text/html;charset=UTF-8" />
<title>JavaScript Object Notation (JSON) Text Sequences</title>

<!-- Text Class Preamble -->
<style type="text/css">
div.toc {
margin: 2em 0em;
border-style: solid;
border-width: 2px 0px;
padding: 1em 0em;
}
div.tochead { font-size: x-large; font-weight: bold; }
div.lyxtoc-0 {
margin: 2em 0em 0em 0em;
font-size: xx-large;
font-weight: bold;
}
div.lyxtoc-1 {
margin: 1em 0em 0em 0em;
font-size: x-large;
font-weight: bold;
}
div.lyxtoc-2 {
margin: 0em 0em 0em 1em;
font-size: large;
font-weight: normal;
}
div.lyxtoc-3 { margin: 0em 0em 0em 0.5em; font-size: medium; }
div.lyxtoc-4 { margin: 0em 0em 0em 0.5em; }
div.lyxtoc-5 { margin: 0em 0em 0em 0.5em; }
div.lyxtoc-6 { margin: 0em 0em 0em 0.5em; }
a.tocentry {
text-decoration: none;
color: black;
}
a.tocentry:visited { color: black; }
a.tocarrow {
font-weight: bold;
text-decoration: none;
color: #909090;
}
a.tocarrow:visited { color: #C0C0C0; }
</style>

<!-- Preamble Snippets -->

<!-- Layout-provided Styles -->
<style type='text/css'>
h1.title {
font-size: x-large;
margin-bottom: 1ex;
text-align: center;

}
div.standard {
text-align: left;

}
div.plain_layout {
text-align: left;

}
div.author {
font-size: large;
margin-top: 1.3ex;
margin-bottom: 0.7ex;
text-align: center;

}
div.abstract {
font-size: small;
margin-top: 0.7ex;
margin-bottom: 0.7ex;
margin-left: 3ex;
margin-right: 3ex;
text-align: left;

}
div.abstract_label {
font-weight: bold;
font-size: large;
text-align: center;

}

div.abstract {
margin: 4ex;
}
div.abstract_item {
font-size: small;
padding-top: 1ex;
}
div.abstract_label {
font-weight: bold;
}
h2.section {
font-weight: bold;
font-size: x-large;
margin-top: 1.3ex;
margin-bottom: 0.7ex;
text-align: left;

}
h3.subsection {
font-weight: bold;
font-size: large;
margin-top: 0.9ex;
margin-bottom: 0.5ex;
text-align: left;

}
ul.itemize {
margin-top: 0.7ex;
margin-bottom: 0.7ex;
margin-left: 3ex;
text-align: left;

}
div.flex_docname {
font-family: serif;
font-weight: normal;
font-style: normal;
font-variant: normal;
font-size: medium;
}
div.flex_ipr {
font-family: serif;
font-weight: normal;
font-style: normal;
font-variant: normal;
font-size: medium;
}
div.flex_intendedstatus {
font-family: serif;
font-weight: normal;
font-style: normal;
font-variant: normal;
font-size: medium;
}
div.flex_titleabbrev {
font-family: serif;
font-weight: normal;
font-style: normal;
font-variant: normal;
font-size: medium;
}
div.flex_ietfarea {
font-family: serif;
font-weight: normal;
font-style: normal;
font-variant: normal;
font-size: medium;
}
div.flex_xml_rfckeyword {
font-family: serif;
font-weight: normal;
font-style: normal;
font-variant: normal;
font-size: medium;
}
div.flex_ietfworkinggroup {
font-family: serif;
font-weight: normal;
font-style: normal;
font-variant: normal;
font-size: medium;
}
div.flex_pi_toc {
font-family: serif;
font-weight: normal;
font-style: normal;
font-variant: normal;
font-size: medium;
}
div.flex_pi_symrefs {
font-family: serif;
font-weight: normal;
font-style: normal;
font-variant: normal;
font-size: medium;
}
div.flex_pi_tocindent {
font-family: serif;
font-weight: normal;
font-style: normal;
font-variant: normal;
font-size: medium;
}
div.flex_pi {
font-family: serif;
font-weight: normal;
font-style: normal;
font-variant: normal;
font-size: medium;
}
div.flex_authororg {
font-family: serif;
font-weight: normal;
font-style: normal;
font-variant: normal;
font-size: medium;
}
div.flex_authororgabbrev {
font-family: serif;
font-weight: normal;
font-style: normal;
font-variant: normal;
font-size: medium;
}
div.flex_authoremailaddr {
font-family: serif;
font-weight: normal;
font-style: normal;
font-variant: normal;
font-size: medium;
}
div.flex_entityxref {
font-family: serif;
font-weight: normal;
font-style: normal;
font-variant: normal;
font-size: medium;
}
div.float {
border: 2px solid black;
text-align: center;
}
div.listings {
font-family: monospace;
}
div.float-caption {
text-align: center;
border: 2px solid black;
padding: 1ex;
margin: 1ex;
}
div.flex_bibxml {
font-family: serif;
font-weight: normal;
font-style: normal;
font-variant: normal;
font-size: medium;
}
</style>
</head>
<body>
<h1 class="title"><a id='magicparlabel-1' />
JavaScript Object Notation (JSON) Text Sequences</h1>
<div class="standard"><a id='magicparlabel-2' />
<div class="flex_docname"><div class="plain_layout"><a id='magicparlabel-6' />
draft-ietf-json-text-sequence-03</div>
</div><div class="flex_ipr"><div class="plain_layout"><a id='magicparlabel-10' />
trust200902</div>
</div><div class="flex_intendedstatus"><div class="plain_layout"><a id='magicparlabel-14' />
std</div>
</div></div>

<div class="standard"><a id='magicparlabel-15' />
<div class="flex_titleabbrev"><div class="plain_layout"><a id='magicparlabel-19' />
JSON Text Sequences</div>
</div><div class="flex_ietfarea"><div class="plain_layout"><a id='magicparlabel-23' />
Apps Area</div>
</div><div class="flex_xml_rfckeyword"><div class="plain_layout"><a id='magicparlabel-27' />
Internet-Draft</div>
</div></div>

<div class="standard"><a id='magicparlabel-28' />
<div class="flex_ietfworkinggroup"><div class="plain_layout"><a id='magicparlabel-32' />
json</div>
</div></div>

<div class="standard"><a id='magicparlabel-33' />
<div class="flex_pi_toc"><div class="plain_layout"><a id='magicparlabel-37' />
yes</div>
</div></div>

<div class="standard"><a id='magicparlabel-38' />
<div class="flex_pi_symrefs"><div class="plain_layout"><a id='magicparlabel-42' />
yes</div>
</div></div>

<div class="standard"><a id='magicparlabel-43' />
<div class="flex_pi_tocindent"><div class="plain_layout"><a id='magicparlabel-47' />
no</div>
</div></div>

<div class="standard"><a id='magicparlabel-48' />
<div class="flex_pi"><div class="plain_layout"><a id='magicparlabel-52' />
comments="yes"</div>
</div><div class="flex_pi"><div class="plain_layout"><a id='magicparlabel-56' />
inline="yes"</div>
</div></div>

<div class="author"><div class="author_item"><a id='magicparlabel-57' />
Nicolas Williams<div class="flex_authororg"><div class="plain_layout"><a id='magicparlabel-61' />
Cryptonector, LLC</div>
</div><div class="flex_authororgabbrev"><div class="plain_layout"><a id='magicparlabel-65' />
Cryptonector</div>
</div><div class="flex_authoremailaddr"><div class="plain_layout"><a id='magicparlabel-69' />
nico@cryptonector.com</div>
</div></div>
</div>

<div class="abstract"><div class="abstract_label">Abstract</div>
<div class="abstract_item"><a id='magicparlabel-70' />
This document describes the JSON text sequence format and associated media type.</div>
</div>
<div class="standard"><a id='magicparlabel-71' />
</div>
<div class='toc'><div class='tochead part_'>Table of Contents</div>

<div class='lyxtoc-1'><a href='#magicparlabel-72' class='tocentry'>1 Introduction and Motivation</a> <a href='#magicparlabel-72' class='tocarrow'>&gt;</a>

<div class='lyxtoc-2'><a href='#magicparlabel-81' class='tocentry'>1.1 Conventions used in this document</a> <a href='#magicparlabel-81' class='tocarrow'>&gt;</a></div>
</div>

<div class='lyxtoc-1'><a href='#magicparlabel-87' class='tocentry'>2 JSON Text Sequence Format</a> <a href='#magicparlabel-87' class='tocarrow'>&gt;</a>

<div class='lyxtoc-2'><a href='#magicparlabel-110' class='tocentry'>2.1 Requirements:</a> <a href='#magicparlabel-110' class='tocarrow'>&gt;</a></div>
</div>

<div class='lyxtoc-1'><a href='#magicparlabel-113' class='tocentry'>3 Use for Logfiles, or How to Resynchronize Following Truncated entries</a> <a href='#magicparlabel-113' class='tocarrow'>&gt;</a></div>

<div class='lyxtoc-1'><a href='#magicparlabel-137' class='tocentry'>4 Security Considerations</a> <a href='#magicparlabel-137' class='tocarrow'>&gt;</a></div>

<div class='lyxtoc-1'><a href='#magicparlabel-146' class='tocentry'>5 IANA Considerations</a> <a href='#magicparlabel-146' class='tocarrow'>&gt;</a></div>

<div class='lyxtoc-1'><a href='#magicparlabel-157' class='tocentry'>6 Normative References</a> <a href='#magicparlabel-157' class='tocarrow'>&gt;</a></div>

<div class='lyxtoc-1'><a href='#magicparlabel-173' class='tocentry'>7 Acknowledgements</a> <a href='#magicparlabel-173' class='tocarrow'>&gt;</a></div>
</div>

<h2 class="section"><span class="section_label">1</span> <a id='magicparlabel-72' />
Introduction and Motivation</h2>
<div class="standard"><a id='magicparlabel-73' />
The JavaScript Object Notation (JSON) <div class="flex_entityxref"><div class="plain_layout"><a id='magicparlabel-77' />
RFC7159</div>
</div> is a very handy serialization format. However, when serializing a large sequence of values as an array, or a possibly indeterminate-length or never-ending sequence of values, JSON becomes difficult to work with.</div>

<div class="standard"><a id='magicparlabel-78' />
Consider a sequence of one million values, each possibly 1 kilobyte when encoded, which would be roughly one gigabyte. If processing such a dataset requires first parsing it entirely, then the result is very inefficient and the processing will be limited by virtual memory. &ldquo;Online&rdquo; (a.k.a., &ldquo;streaming&rdquo;) parsers help, but they are neither widely available or widely used, nor are they easy to use.</div>

<div class="standard"><a id='magicparlabel-79' />
Ideally such datasets could be parsed and processed one element at a time. Even if each element must be parsed in a not-online manner due to local choice of parser, the result will usually be sufficiently online: limited by the size of the biggest element in the sequence rather than by the size of the sequence.</div>

<div class="standard"><a id='magicparlabel-80' />
This document describes the concept and format of &ldquo;JSON text sequences&rdquo;, which are specifically not JSON texts themselves but are composed of JSON texts.</div>
<h3 class="subsection"><span class="subsection_label">1.1</span> <a id='magicparlabel-81' />
Conventions used in this document</h3>
<div class="standard"><a id='magicparlabel-82' />
The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <div class="flex_entityxref"><div class="plain_layout"><a id='magicparlabel-86' />
RFC2119</div>
</div>.</div>
<h2 class="section"><span class="section_label">2</span> <a id='magicparlabel-87' />
<a id="sec_JSON_Text_Sequence" />
JSON Text Sequence Format</h2>
<div class="standard"><a id='magicparlabel-88' />
The ABNF <div class="flex_entityxref"><div class="plain_layout"><a id='magicparlabel-92' />
RFC5234</div>
</div> for the JSON text sequence format is as given in <a href="#fig_JSON_text_sequence">1</a>. Note that this ABNF does not work if we assume greedy matching. Therefore, in prose, a JSON text sequence is a sequence of zero or more JSON texts, each surrounded by any number of JSON whitespace characters and always followed by a newline.</div>

<div class="standard"><a id='magicparlabel-93' />
</div>
<div class='float float-figure'><div class="plain_layout"><a id='magicparlabel-97' />
</div>
<div class='float float-listings'><pre>  JSON-sequence = ws *(JSON-text ws LF ws)
  LF = &lt;given by RFC5234&gt;
  ws = &lt;given by RFC7159&gt;
  JSON-text = &lt;given by RFC7159&gt;</pre></div>


<div class="plain_layout"><a id='magicparlabel-105' />
<div class='float-caption float-caption-figure'>Figure 1:<div class="plain_layout"><a id='magicparlabel-109' />
<a id="fig_JSON_text_sequence" />
JSON text sequence ABNF</div>
</div></div>
</div>

<h3 class="subsection"><span class="subsection_label">2.1</span> <a id='magicparlabel-110' />
Requirements:</h3>

<ul class="itemize"><li class="itemize_item"><a id='magicparlabel-111' />
JSON text sequence encoders MUST emit a newline after any JSON text.</li>
</ul>
<div class="standard"><a id='magicparlabel-112' />
An input of 'truefalse' is not a valid sequence of two JSON values, true and false! Neither is 'true0' a valid sequence of true and zero. Some existing JSON parsers that might be used to construct sequence parsers might in fact accept such sequences, resulting in erroneous parsing of sequences of two or more numbers. E.g., a sequence of two numbers, 4 and 2, encoded without the required whitespace between them would parse incorrectly as the number 42. This ambiguity is resolved by requiring that encoders emit a whitespace separator (specifically: a newline) after each text.</div>
<h2 class="section"><span class="section_label">3</span> <a id='magicparlabel-113' />
Use for Logfiles, or How to Resynchronize Following Truncated entries</h2>
<div class="standard"><a id='magicparlabel-114' />
The JSON Text Sequence format is useful for logfiles, as those are generally (and atomically) appended to on an ongoing basis. I.e., logfiles are of indeterminate length, at least right up until they closed.</div>

<div class="standard"><a id='magicparlabel-115' />
A problem comes up with this use case: it is difficult to guarantee that append writes will complete. Therefore it's possible (if unlikely) to end up with truncated log entries -which may fail to parse as JSON texts- followed by other entries. The mechanics of such failures are not explained here (but consider power failures).</div>

<div class="standard"><a id='magicparlabel-116' />
Fortunately, as long as all texts in the logfile sequence are followed by a newline, it is possible to detect a subsequent entry written after an entry that fails to parse. <a href="#fig_ABNF_for_resynchronization">2</a> shows an ABNF rule for detecting the boundary between a non-truncated [and some truncated] JSON text and the next JSON text in a sequence.</div>

<div class="standard"><a id='magicparlabel-117' />
</div>
<div class='float float-figure'><div class="plain_layout"><a id='magicparlabel-121' />
</div>
<div class='float float-listings'><pre>  boundary = endchar *text-sep *ws startchar
  text-sep = *(SP / HTAB / CR) LF ; these are from RFC5234
  endchar = ( "}" / "]" / DQUOTE / "e" / "l" / DIGIT )
  startchar =  ( "{" / "[" / DQUOTE / "t" / "f" / "n" / "-" / DIGIT )
  ws = &lt;given by RFC7159&gt;</pre></div>


<div class="plain_layout"><a id='magicparlabel-130' />
<div class='float-caption float-caption-figure'>Figure 2:<div class="plain_layout"><a id='magicparlabel-134' />
<a id="fig_ABNF_for_resynchronization" />
ABNF for resynchronization</div>
</div></div>
</div>


<div class="standard"><a id='magicparlabel-135' />
To resynchronize after failing to parse a JSON text, simply search for a boundary as described in figure 2. A boundary found this way might be the boundary between the truncated entry and the subsequent entry, or it might be a subsequent boundary.</div>

<div class="standard"><a id='magicparlabel-136' />
Scanning backwards for boundaries may not work reliably unless JSON texts written to logfiles are stripped of internal newlines.</div>
<h2 class="section"><span class="section_label">4</span> <a id='magicparlabel-137' />
<a id="sec_Security_Considerations" />
Security Considerations</h2>
<div class="standard"><a id='magicparlabel-138' />
All the security considerations of JSON <div class="flex_entityxref"><div class="plain_layout"><a id='magicparlabel-142' />
RFC7159</div>
</div> apply.</div>

<div class="standard"><a id='magicparlabel-143' />
There is no end of sequence indicator. This means that &ldquo;end of file&rdquo;, &ldquo;end of transmission&rdquo;, and so on, can be indistinguishable from a logical end of sequence. Applications where this matters should denote end of sequence by convention (e.g., Content-Length in HTTP).</div>

<div class="standard"><a id='magicparlabel-144' />
JSON text sequence parsers based on non-incremental, non-online JSON text parsers will not be able to efficiently parser JSON texts in which newlines appear; attempting to parse such sequences with non-incremental, non-online JSON text parsers creates a compute resource exhaustion vulnerability.</div>

<div class="standard"><a id='magicparlabel-145' />
The resynchronization heuristic for logfiles is imperfect and might skip a valid entry following a truncated one. Purposefully appending a truncated (or invalid) JSON text to a JSON text sequence logfile can cause the subsequent entry to be invisible. Logfile writers SHOULD validate (parse) any untrusted JSON text inputs and SHOULD remove internal newlines from them, thus enabling reliable backwards scanning for sequence element boundaries. Alternatively, logfile writers might write texts in sequences of two texts, the first being meaningless by convention. Of course, logfile writers SHOULD also ensure that their writes are atomic, at least in so far as not interleaving with other writers' writes.</div>
<h2 class="section"><span class="section_label">5</span> <a id='magicparlabel-146' />
<a id="sec_IANA_Considerations" />
IANA Considerations</h2>
<div class="standard"><a id='magicparlabel-147' />
The MIME media type for JSON text sequences is application/json-seq.</div>

<div class="standard"><a id='magicparlabel-148' />
Type name: application</div>

<div class="standard"><a id='magicparlabel-149' />
Subtype name: json-seq</div>

<div class="standard"><a id='magicparlabel-150' />
Required parameters: n/a</div>

<div class="standard"><a id='magicparlabel-151' />
Optional parameters: n/a</div>

<div class="standard"><a id='magicparlabel-152' />
Encoding considerations: binary</div>

<div class="standard"><a id='magicparlabel-153' />
Security considerations: See &lt;this document, once published&gt;, <a href="#sec_Security_Considerations">4</a>.</div>

<div class="standard"><a id='magicparlabel-154' />
Interoperability considerations: Described herein.</div>

<div class="standard"><a id='magicparlabel-155' />
Published specification: &lt;this document, once published&gt;.</div>

<div class="standard"><a id='magicparlabel-156' />
Applicat<a href="http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.2119.xml">rfc2119</a>ions that use this media type: JSON text sequences have been used in applications written with the jq programming language.</div>
<h2 class="section"><span class="section_label">6</span> <a id='magicparlabel-157' />
<a id="sec_References" />
Normative References</h2>
<div class="standard"><a id='magicparlabel-158' />
<div class="flex_bibxml"><div class="plain_layout"><a id='magicparlabel-162' />
<a href="http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.2119.xml">rfc2119</a></div>
</div></div>

<div class="standard"><a id='magicparlabel-163' />
<div class="flex_bibxml"><div class="plain_layout"><a id='magicparlabel-167' />
<a href="http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.5234.xml">rfc5234</a></div>
</div></div>

<div class="standard"><a id='magicparlabel-168' />
<div class="flex_bibxml"><div class="plain_layout"><a id='magicparlabel-172' />
<a href="http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7159.xml">rfc7159</a></div>
</div></div>
<h2 class="section"><span class="section_label">7</span> <a id='magicparlabel-173' />
Acknowledgements</h2>
<div class="standard"><a id='magicparlabel-174' />
Phillip Hallam-Baker proposed the use of JSON text sequences for logfiles and pointed out the need for resynchronization. James Manger contributed the ABNF for resynchronization.</div>
</body>
</html>
